# syntax=docker/dockerfile:1
FROM emergingai/enova:base-npu

COPY ./llmo /opt/enova/llmo

COPY ./scripts /opt/enova/scripts

RUN bash /opt/enova/scripts/pack_whl.llmo.sh 

# ARG LLMO_VERSION=0.1.0
# RUN pip install /opt/enova/llmo/enova-instrumentation-llmo/dist/enova_instrumentation_llmo-${LLMO_VERSION}-py3-none-any.whl --no-deps --no-cache-dir

ARG CACHEBUST=1

COPY . /opt/enova 


RUN cd /opt/enova && rm MANIFEST.in && bash ./scripts/pack_whl.enova.sh
ARG ENOVA_VERSION=0.1.0

RUN pip install -r /opt/enova/requirements-docker.npu.txt --no-deps  --no-cache-dir && \
    pip install /opt/enova/dist/enova-${ENOVA_VERSION}-py3-none-any.whl --no-deps --no-cache-dir && \
    pip uninstall -y transformer-engine && mkdir -p /workspace/model

